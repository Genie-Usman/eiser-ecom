{% liquid
  assign current_variant = product.selected_or_first_available_variant
  assign in_stock = current_variant.available
%}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<section class="py-10 md:pb-14 md:mt-5">
  <div class="container mx-auto md:px-20 px-4">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 lg:gap-6">
      <!-- Gallery -->
      <div class="lg:col-span-6">
        <media-gallery class="gallery-container relative block" data-layout="slider">
          <!-- Main Slider -->
          <div class="swiper gallery-main aspect-4/5 bg-gray-100 rounded-lg overflow-hidden">
            <div class="swiper-wrapper" id="main-slider-wrapper">
              <!-- JS injects slides -->
            </div>
          </div>

          <!-- Thumbnail Slider -->
          <div class="swiper gallery-thumbs absolute top-2 bottom-0 right-4 z-10 w-auto max-w-[calc(100%-2rem)] transition-all duration-300 ease-in-out">
            <div class="swiper-wrapper" id="thumb-slider-wrapper">
              <!-- JS injects thumbs -->
            </div>
          </div>

          <!-- Hidden JSON Data -->
          <script type="application/json" id="ProductMediaJSON">
                [
                    {% for media in product.media %}
                        {
                            "id": {{ media.id }},
                            "media_type": "{{ media.media_type }}",
                            {% if media.media_type == 'video' %}
                                {% assign video_source = media.sources | where: "format", "mp4" | first %}
                                "src": "{{ video_source.url | default: media.sources[0].url }}",
                            {% elsif media.media_type == 'external_video' %}
                                {% if media.host == 'youtube' %}
                                    "src": "https://www.youtube.com/embed/{{ media.external_id }}?enablejsapi=1",
                                {% elsif media.host == 'vimeo' %}
                                    "src": "https://player.vimeo.com/video/{{ media.external_id }}",
                                {% endif %}
                            {% else %}
                                "src": "{{ media | image_url: width: 1200 }}",
                            {% endif %}
                            "preview_image": "{{ media.preview_image | image_url: width: 300 }}",
                            "alt": {{ media.alt | json }}
                        }{% unless forloop.last %},{% endunless %}
                    {% endfor %}
                ]
          </script>
        </media-gallery>
      </div>

      <!-- Info -->
      <div class="lg:col-span-5 lg:col-start-8 mt-24">
        <div class="s_product_text">
          <h1 class="text-[24px] md:text-[26px] font-medium text-gray-900 leading-tight">{{ product.title | escape }}</h1>

          <div class="mt-2 flex items-center gap-4" id="price-{{ section.id }}">
            <p class="text-[#71CD14] text-[22px] font-bold">{{ current_variant.price | money }}</p>
            {% if current_variant.compare_at_price > current_variant.price %}
              <p class="text-gray-400 line-through">{{ current_variant.compare_at_price | money }}</p>
            {% endif %}
          </div>

          <ul class="mt-3 space-y-2 text-sm">
            <li class="text-[#797979]">
              <span class="text-[#555555]">Category&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</span>
              {% if product.type != blank %}
                <span class="text-[#7fad39]">{{ product.type | escape }}</span>
              {% else %}
                <span class="text-gray-500">—</span>
              {% endif %}
            </li>

            <li class="text-[#797979]" id="availability-{{ section.id }}">
              <span class="text-[#555555]">Availability&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</span>
              {% if in_stock %}
                <span class="text-[#7fad39]">In stock</span>
              {% else %}
                <span class="text-rose-600">Out of stock</span>
              {% endif %}
            </li>
          </ul>

          <div class="mt-4 border-b border-dotted border-gray-200"></div>

          {% if product.description != blank %}
            <div class="my-5 text-sm leading-relaxed text-[#797979] max-w-[640px]">
              {{ product.description }}
            </div>
          {% endif %}

          <div class="mt-6">
            {% assign form_id = 'product-form-' | append: section.id %}
            {% form 'product'
              , product
              , id: form_id
              , class: 'space-y-6'
              , data-product-form: true %}
              <variant-selector data-url="{{ product.url }}" data-section="{{ section.id }}">
                <!-- Master Select (Hidden) -->
                <select
                  id="MasterVariantSelect"
                  name="id"
                  class="hidden">
                  {% for variant in product.variants %}
                    <option
                      value="{{ variant.id }}"
                      {% for option in variant.options %}
                      data-option-{{ forloop.index0 }}
                      ="{{ option }}"
                      {% endfor %}
                      {% if variant == current_variant %}
                      selected{% endif %}
                      {% unless variant.available %}
                      disabled{% endunless %}>
                      {{ variant.title }}
                    </option>
                  {% endfor %}
                </select>

                {% for option in product.options_with_values %}
                  <fieldset
                    class="mb-4"
                    data-option-index="{{ forloop.index0 }}"
                    data-option-name="{{ option.name }}">
                    <legend class="text-sm font-semibold uppercase tracking-wide text-gray-500 mb-3">{{ option.name }}</legend>
                    <div class="flex flex-wrap gap-3" id="{{ option.name }}FieldSet">
                      {% for value in option.values %}
                        <label class="cursor-pointer">
                          <input
                            type="radio"
                            name="{{ option.name }}"
                            value="{{ value }}"
                            class="peer sr-only"
                            {% if option.selected_value == value %}
                            checked{% endif %}>
                          {% if option.name == 'Color' %}
                            {% assign swatch_style = "" %}
                            {% if value.swatch.image %}
                              {% assign image_url = value.swatch.image | image_url: width: 80 %}
                              {% assign swatch_style = "background-image: url('" | append: image_url | append: "'); background-size: cover; background-position: center;" %}
                            {% elsif value.swatch.color %}
                              {% assign swatch_style = "background-color: " | append: value.swatch.color | append: ";" %}
                            {% else %}
                              {% assign handle_color = value | handle %}
                              {% assign texture_url = handle_color | append: '.png' | file_url %}
                              {% assign swatch_style = "background-color: " | append: handle_color | append: "; background-image: url('" | append: texture_url | append: "');" %}
                            {% endif %}

                            <div class="relative group/swatch">
                              <!-- Tooltip -->
                              <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover/swatch:block whitespace-nowrap z-50 pointer-events-none">
                                <div class="relative bg-gray-900 text-white text-[11px] font-medium py-1 px-2 rounded shadow-lg">
                                  {{ value }}
                                  <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
                                </div>
                              </div>

                              <!-- Swatch -->
                              <span class="block w-8 h-8 rounded-full border border-gray-300 cursor-pointer bg-cover bg-center transition-all hover:border-gray-400 peer-checked:ring-1 peer-checked:ring-offset-2 peer-checked:ring-gray-900 peer-checked:border-gray-400" style="{{ swatch_style }}"></span>
                            </div>
                          {% else %}
                            <!-- Other Style (Simple Box) -->
                            <span class="px-4 py-2 border border-gray-300 rounded peer-checked:bg-black peer-checked:text-white peer-checked:border-black transition block min-w-[3rem] text-center">
                              {{ value }}
                            </span>
                          {% endif %}
                        </label>
                      {% endfor %}
                    </div>
                  </fieldset>
                {% endfor %}
              </variant-selector>

              <div class="mt-4 flex flex-col items-stretch gap-4">
                <div class="flex items-center gap-6">
                  <div class="text-[#797979] text-sm leading-none">Quantity:</div>
                  <div class="relative">
                    <input
                      id="qty-{{ section.id }}"
                      name="quantity"
                      type="number"
                      inputmode="numeric"
                      min="1"
                      value="1"
                      class="qty-input w-[80px] h-[30px] rounded-md font-semibold border border-[#e7e7e7] bg-white pl-3 text-[12px] leading-none text-gray-900 text-left outline-none appearance-none">
                    <div class="absolute inset-y-0 right-2 w-[18px] flex flex-col rounded-r-[14px] overflow-hidden">
                      <button
                        type="button"
                        class="flex-1 grid place-content-center text-[#cfcfcf] hover:text-black transition-colors duration-300 ease-in-out cursor-pointer"
                        data-qty-plus="qty-{{ section.id }}"
                        aria-label="Increase quantity">
                        {% render 'icon-chevron-up' %}
                      </button>
                      <button
                        type="button"
                        class="flex-1 grid place-content-center text-[#cfcfcf] hover:text-black transition-colors duration-300 ease-in-out cursor-pointer"
                        data-qty-minus="qty-{{ section.id }}"
                        aria-label="Decrease quantity">
                        {% render 'icon-chevron-down' %}
                      </button>
                    </div>
                  </div>
                </div>

                <div class="flex flex-row gap-3 mt-5">

                  <button
                    type="submit"
                    class="inline-flex items-center justify-center h-10 px-7 bg-[#71CD14] hover:bg-transparent border border-[#71CD14] hover:text-[#71CD14] uppercase transition-all duration-400 cursor-pointer ease-in-out text-white text-xs font-medium rounded disabled:opacity-50 disabled:cursor-not-allowed"
                    data-add-to-cart
                    {% unless current_variant.available %}
                    disabled{% endunless %}>
                    {% if current_variant.available %}
                      Add to cart
                    {% else %}
                      Sold Out
                    {% endif %}
                  </button>
                  <div class="flex items-center gap-2">
                    <button
                      type="button"
                      class="w-10 h-10 grid place-content-center bg-[#F6F6F6] cursor-pointer hover:bg-transparent rounded tile-btn"
                      aria-label="Compare">
                      {% render 'icon-diamond' %}
                    </button>
                    <button
                      type="button"
                      class="w-10 h-10 grid place-content-center bg-[#F6F6F6] cursor-pointer hover:bg-transparent  rounded tile-btn"
                      aria-label="Wishlist"
                      data-wishlist
                      data-product-handle="{{ product.handle }}">
                      {% render 'icon-heart' %}
                    </button>
                  </div>
                </div>
              </div>
            {% endform %}
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="mt-14 border border-[#F6F6F6]">
      <div class="flex gap-3 overflow-hidden bg-[#F6F6F6] flex-row justify-center py-2.5">
        {% assign tabs = 'Description|Specification|Comments|Reviews' | split: '|' %}
        {% for title in tabs %}
          <button
            type="button"
            class="tab-btn px-8 py-3 text-xs border font-medium cursor-pointer bg-[#FFFFFF] border-gray-200 text-[#2A2A2A] hover:text-[#71CD14] data-[active=true]:bg-[#71CD14] data-[active=true]:text-white"
            data-tab-target="tab-{{ forloop.index }}-{{ section.id }}"
            aria-pressed="false">
            {{ title }}
          </button>
        {% endfor %}
      </div>

      <div class="mt-6 px-10 pt-2 pb-8">
        <!-- Description -->
        <div id="tab-1-{{ section.id }}" class="tab-pane hidden">
          <div class="text-sm text-[#797979] leading-7 max-full">
            {{ product.metafields.custom.description | default: '—' }}
          </div>
        </div>

        <!-- Specification -->
        <div id="tab-2-{{ section.id }}" class="tab-pane hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full text-left text-sm">
              <tbody class="divide-y divide-gray-200">
                {% if product.metafields.custom.tech_specs_list.value != blank %}

                  {% for item in product.metafields.custom.tech_specs_list.value %}
                    <tr>
                      <td class="py-5 pl-10 font-medium text-[#797979]">
                        {% if item.icon != blank %}
                          {{ item.icon | image_url: width: 20 | image_tag: class: 'inline-block mr-2 align-middle object-contain', loading: 'lazy' }}
                        {% endif %}
                        {{ item.label }}
                      </td>
                      <td class="py-2 text-[#797979]">
                        {{ item.value | newline_to_br }}
                      </td>
                    </tr>
                  {% endfor %}

                {% else %}

                  <tr>
                    <td class="py-5 pl-10 font-medium text-[#797979]">Status</td>
                    <td class="py-2 text-[#797979]">No specs linked. Check Product Metafields.</td>
                  </tr>
                  <tr>
                    <td class="py-5 pl-10 font-medium text-[#797979]">Width</td>
                    <td class="py-2 text-[#797979]">{{ product.metafields.custom.width | default: '—' }}</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Comments -->
        <div id="tab-3-{{ section.id }}" class="tab-pane hidden">
          <div class="grid md:grid-cols-2 gap-10">
            <!-- Comments list -->
            <div class="space-y-8">
              {% assign comment_images = 'review-1.png|review-2.png|review-3.png' | split: '|' %}
              {% for i in (1..3) %}
                {% assign image_index = forloop.index0 %}
                {% assign review_image = comment_images[image_index] %}
                <div class="flex gap-5">
                  <div class="w-16 h-16 rounded-full overflow-hidden shrink-0">
                    <img
                      src="{{ review_image | asset_url }}"
                      alt="Reviewer"
                      class="w-full h-full object-cover"
                      loading="lazy"
                      width="64"
                      height="64">
                  </div>
                  <div class="flex-1">
                    <div class="flex items-center gap-3">
                      <h4 class="font-medium text-gray-900">Blake Ruiz</h4>
                      <p class="text-xs text-[#797979]">12th Feb, 2017 at 05:56 pm</p>
                    </div>
                    <p class="mt-2 text-sm leading-6 text-[#797979]">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo.</p>
                    <div class="mt-3">
                      <button type="button" class="px-5 h-9 inline-flex items-center justify-center border border-gray-300 text-[#2A2A2A] rounded-full hover:border-gray-400 uppercase text-xs">Reply</button>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>

            <!-- Comment form -->
            <div>
              <h4 class="text-gray-900 font-semibold mb-4">Post a comment</h4>
              <form class="grid grid-cols-1 gap-4">
                <input
                  type="text"
                  class="h-9 border border-gray-300 rounded px-4 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Your Full name">
                <input
                  type="email"
                  class="h-11 border border-gray-300 rounded px-4 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Email Address">
                <input
                  type="text"
                  class="h-11 border border-gray-300 rounded px-4 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Phone Number">
                <textarea
                  class="border border-gray-300 rounded px-4 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13] resize-y"
                  rows="1"
                  placeholder="Message"></textarea>
                <div class="text-end">
                  <button type="button" class="inline-flex h-11 cursor-pointer items-center bg-[#71cd13] hover:bg-transparent border border-[#71cd13] hover:text-[#71cd13] px-6 text-sm font-semibold uppercase tracking-wide text-white transition-colors duration-200 ease-in">Submit Now</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Reviews -->
        <div id="tab-4-{{ section.id }}" class="tab-pane hidden">
          <div class="grid md:grid-cols-2 gap-10">
            <!-- Left: overall + breakdown + recent reviews -->
            <div>
              <div class="grid grid-cols-2 gap-6">
                <!-- Overall card -->
                <div class="bg-[#F5F5F5] rounded p-6 text-center">
                  <h5 class="text-[#2A2A2A] text-2xl font-medium">Overall</h5>
                  <p class="mt-2 text-[44px] leading-none font-bold text-[#71CD14]">4.0</p>
                  <p class="mt-3 text-sm text-[#797979]">(03 Reviews)</p>
                </div>
                <!-- Breakdown -->
                <div>
                  <h3 class="text-gray-900 font-semibold mb-2 text-xl">Based on 3 Reviews</h3>
                  <ul class="-space-y-1 text-sm text-[#797979]">
                    {% assign breakdown = '5|4|3|2|1' | split: '|' %}
                    {% for stars in breakdown %}
                      <li class="flex items-center gap-2">
                        <span>{{ stars }} Star</span>
                        <span class="text-yellow-400 text-xl">★★★★★</span>
                        <span>01</span>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>

              <div class="mt-8 space-y-8">
                {% assign review_images = 'review-1.png|review-2.png|review-3.png' | split: '|' %}
                {% for i in (1..3) %}
                  {% assign image_index = forloop.index0 %}
                  {% assign review_image = review_images[image_index] %}
                  <div class="flex items-start gap-4">
                    <div class="w-16 h-16 rounded-full overflow-hidden shrink-0">
                      <img
                        src="{{ review_image | asset_url }}"
                        alt="Reviewer"
                        class="w-full h-full object-cover"
                        loading="lazy"
                        width="64"
                        height="64">
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center gap-3">
                        <h4 class="font-medium text-gray-900">Blake Ruiz</h4>
                        <div class="text-yellow-400 text-xl">★★★★★</div>
                      </div>
                      <p class="mt-2 text-sm leading-6 text-[#797979]">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo.</p>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>

            <!-- Right: add a review form -->
            <div>
              <h4 class="text-gray-900 font-semibold mb-4 text-2xl">Add a Review</h4>
              <div class="mb-4 flex items-center gap-3 text-sm text-[#797979]">
                <span>Your Rating:</span>
                <div class="flex items-center gap-1">
                  <span class="text-yellow-400 text-xl">★★★★★</span>
                </div>
                <span>Outstanding</span>
              </div>
              <form class="grid grid-cols-1 gap-3">
                <input
                  type="text"
                  class="h-10 border border-gray-300 rounded px-3 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Your Full name">
                <input
                  type="email"
                  class="h-10 border border-gray-300 rounded px-3 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Email Address">
                <input
                  type="text"
                  class="h-10 border border-gray-300 rounded px-3 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Phone Number">
                <textarea
                  class="border border-gray-300 rounded px-3 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13] resize-y"
                  rows="1"
                  placeholder="Review"></textarea>
                <div class="text-end mt-1">
                  <button type="button" class="inline-flex h-11 cursor-pointer items-center bg-[#71cd13] hover:bg-transparent border border-[#71cd13] hover:text-[#71cd13] px-6 text-sm font-semibold uppercase tracking-wide text-white transition-colors duration-200 ease-in">Submit Now</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* User Modeling CSS */
    .variant-option.selected {
      ring: 2px solid #000;
      background-color: #f3f4f6;
      border-color: #000;
    }

    /* Swiper Fixes */
    .swiper {
      width: 100%;
      height: 100%;
    }
    .swiper-slide {
      display: flex;
      justify-content: center;
      align-items: center;
      background: #fff;
    }
    .swiper-slide img,
    .swiper-slide video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }

    .gallery-thumbs {
      box-sizing: border-box;
      padding: 0;
      background: transparent;
    }
    .gallery-thumbs .swiper-slide {
      width: 60px !important;
      /* Force small size */
      height: 60px !important;
      opacity: 1;
      /* Always visible */
      cursor: pointer;
      transition: all 0.2s;
      border-radius: 10px;
      overflow: hidden;
      margin-right: 10px !important;
      /* Spacing */
    }
    .gallery-thumbs .swiper-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .gallery-thumbs .swiper-slide-thumb-active {
      border: 2px solid #71CD14;
      /* Brand color border */
    }

    /* Dynamic positioning for video */
    media-gallery.video-active .gallery-thumbs {
      bottom: 6rem !important;
      /* ~96px, clears video controls */
    }

    /* Accessibility: Visually hide elements but keep accessible */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Hide native number input controls; we use our own chevrons */
    #qty-{{ section.id }}::-webkit-outer-spin-button,
    #qty-{{ section.id }}::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    #qty-{{ section.id }} {
      -moz-appearance: textfield;
    }
    /* Hover shadow for small icon tiles (lower-left) */
    .tile-btn {
      transition: box-shadow 220ms ease
      , transform 220ms ease
      , background-color 220ms ease;
      box-shadow: none;
    }
    .tile-btn:hover {
      box-shadow: -20px 20px 30px rgba(0, 0, 0, 0.16);
    }
  </style>

  <script>
    (function() {
      // AJAX add to cart
      var productForm = document.querySelector('[data-product-form]');
      if (productForm) {
        var addButton = productForm.querySelector('[data-add-to-cart]');
        var statusEl = productForm.querySelector('[data-add-status]');
        var qtyInput = productForm.querySelector('input[name="quantity"]');
        var variantSelector = productForm.querySelector('select[name="id"], input[name="id"]');
        function announceCartChange(){
          try { window.dispatchEvent(new CustomEvent('cart:updated')); } catch(err) {}
          try { window.dispatchEvent(new CustomEvent('cart:refresh')); } catch(err) {}
        }

        function showStatus(message, tone) {
          if (!statusEl) return;
          statusEl.textContent = message;
          statusEl.classList.remove('hidden');
          if (tone === 'error') {
            statusEl.classList.add('text-rose-600');
            statusEl.classList.remove('text-[#71cd13]');
          } else {
            statusEl.classList.add('text-[#71cd13]');
            statusEl.classList.remove('text-rose-600');
          }
          if (statusEl._timer) clearTimeout(statusEl._timer);
          statusEl._timer = setTimeout(function(){ statusEl.classList.add('hidden'); }, tone === 'error' ? 4000 : 2200);
        }

        productForm.addEventListener('submit', function(event) {
          event.preventDefault();
          if (addButton) addButton.disabled = true;

          var variantId = variantSelector ? variantSelector.value : '';
          var quantity = qtyInput ? parseInt(qtyInput.value || '1', 10) : 1;
          if (!variantId) {
            showStatus('Select an option', 'error');
            if (addButton) addButton.disabled = false;
            return;
          }

          quantity = Math.max(1, Number.isFinite(quantity) ? quantity : 1);

          var payload = { id: variantId, quantity: quantity };
          var request;

          if (window.ShopCart && typeof window.ShopCart.add === 'function') {
            request = window.ShopCart.add(payload);
          } else {
            request = fetch('/cart/add.js', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            })
              .then(function(response) {
                if (!response.ok) throw new Error('Request failed');
                return response.json();
              });
          }

          Promise.resolve(request)
            .then(function(){
              showStatus('Added to cart', 'success');
              announceCartChange();
            })
            .catch(function(){
              showStatus('Could not add to cart', 'error');
            })
            .finally(function(){
              if (addButton) addButton.disabled = false;
            });
        });
      }
    
      // Quantity controls
      var minus = document.querySelector('[data-qty-minus="qty-{{ section.id }}"]');
      var plus = document.querySelector('[data-qty-plus="qty-{{ section.id }}"]');
      var input = document.getElementById('qty-{{ section.id }}');
      if (minus && plus && input) {
        minus.addEventListener('click', function(){
          var v = parseInt(input.value || '1', 10);
          input.value = Math.max(1, v - 1);
        });
        plus.addEventListener('click', function(){
          var v = parseInt(input.value || '1', 10);
          input.value = v + 1;
        });
      }
    
      // Tabs
      var tabButtons = document.querySelectorAll('.tab-btn[data-tab-target$="{{ section.id }}"]');
      var panes = document.querySelectorAll('.tab-pane[id$="{{ section.id }}"]');
      function activate(targetId) {
        panes.forEach(function(p){ p.classList.add('hidden'); });
        tabButtons.forEach(function(b){ b.dataset.active = 'false'; b.setAttribute('aria-pressed', 'false'); });
        var p = document.getElementById(targetId);
        var b = Array.prototype.find.call(tabButtons, function(x){ return x.dataset.tabTarget === targetId; });
        if (p) p.classList.remove('hidden');
        if (b) { b.dataset.active = 'true'; b.setAttribute('aria-pressed', 'true'); }
      }
      if (tabButtons.length) {
        tabButtons.forEach(function(btn){
          btn.addEventListener('click', function(){ activate(btn.dataset.tabTarget); });
        });
        if (document.getElementById('tab-4-{{ section.id }}')) {
          activate('tab-4-{{ section.id }}');
        }
      }
    })();
  </script>
</section>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="{{ 'product-gallery.js' | asset_url }}" defer></script>
<script src="{{ 'variant-selector.js' | asset_url }}" defer></script>

{% schema %}
  {
    "name": "Product",
    "tag": "section",
    "class": "section-product-detail",
    "settings": [],
    "disabled_on": {
      "groups": ["header", "footer"]
    }
  }
{% endschema %}