{% liquid
  assign current_variant = product.selected_or_first_available_variant
  assign in_stock = current_variant.available
%}

<section class="py-10 md:pb-14 md:mt-5">
  <div class="container mx-auto px-20">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 lg:gap-6">
      <!-- Gallery -->
      <div class="lg:col-span-6">
        <div id="pd-{{ section.id }}" class="relative">
          {% if product.media.size > 0 %}
            <div id="carousel-{{ section.id }}" class="relative">
              <div class="overflow-hidden bg-white relative">
                <div class="flex transition-transform duration-500 ease-out" data-track>
                  {% for media in product.media %}
                    <div class="w-full shrink-0 aspect-4/5 flex items-center justify-center bg-white">
                      {% if forloop.first %}
                        {{ media | media_tag: image_size: '1200x', class: 'w-full h-full object-contain', loading: 'eager', widths: '600,900,1200' }}
                      {% else %}
                        {{ media | media_tag: image_size: '1200x', class: 'w-full h-full object-contain', loading: 'lazy', widths: '600,900,1200' }}
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              </div>
              <!-- Overlaid thumbnails (exclude first media) -->
              <ol class="absolute right-8 bottom-17 grid grid-flow-col auto-cols-[56px] gap-3" data-thumbs>
                {% for media in product.media %}
                  {% unless forloop.first %}
                    <li>
                      <button
                        type="button"
                        class="group relative overflow-hidden aspect-square bg-white border border-gray-200 focus:outline-none"
                        data-slide-to="{{ forloop.index0 }}"
                        data-active="false">
                        {{ media | media_tag: image_size: '300x', class: 'w-full h-full object-contain pointer-events-none' }}
                        <span class="absolute inset-0 bg-transparent group-data-[active=true]:bg-red-500/60"></span>
                      </button>
                    </li>
                  {% endunless %}
                {% endfor %}
              </ol>
            </div>
          {% else %}
            <div class="aspect-4/5 bg-gray-50 border border-gray-200 rounded"></div>
          {% endif %}
        </div>
      </div>

      <!-- Info -->
      <div class="lg:col-span-5 lg:col-start-8 mt-24">
        <div class="s_product_text">
          <h1 class="text-[24px] md:text-[26px] font-medium text-gray-900 leading-tight">{{ product.title | escape }}</h1>

          <div class="mt-2 flex items-center gap-4">
            <p class="text-[#71CD14] text-[22px] font-bold">{{ current_variant.price | money }}</p>
            {% if current_variant.compare_at_price > current_variant.price %}
              <p class="text-gray-400 line-through">{{ current_variant.compare_at_price | money }}</p>
            {% endif %}
          </div>

          <ul class="mt-3 space-y-2 text-sm">
            <li class="text-[#797979]">
              <span class="text-[#555555]">Category&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</span>
              {% if product.type != blank %}
                <span class="text-[#7fad39]">{{ product.type | escape }}</span>
              {% else %}
                <span class="text-gray-500">—</span>
              {% endif %}
            </li>

            <li class="text-[#797979]">
              <span class="text-[#555555]">Availability&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</span>
              {% if in_stock %}
                <span class="text-[#7fad39]">In stock</span>
              {% else %}
                <span class="text-rose-600">Out of stock</span>
              {% endif %}
            </li>
          </ul>

          <div class="mt-4 border-b border-dotted border-gray-200"></div>

          {% if product.description != blank %}
            <div class="my-5 text-sm leading-relaxed text-[#797979] max-w-[640px]">
              {{ product.description }}
            </div>
          {% endif %}

          <div class="mt-6">
            {% assign form_id = 'product-form-' | append: section.id %}
            {% form 'product'
              , product
              , id: form_id
              , class: 'space-y-6'
              , data-product-form: true %}
              {% if product.has_only_default_variant == false %}
                <label for="variant-id-{{ section.id }}" class="sr-only">Variant</label>
                <select
                  id="variant-id-{{ section.id }}"
                  name="id"
                  class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                  {% for variant in product.variants %}
                    <option
                      value="{{ variant.id }}"
                      {% if variant == current_variant %}
                      selected{% endif %}
                      {% if variant.available == false %}
                      disabled{% endif %}>
                      {{ variant.title }}{% if variant.available == false %}
                        — Sold out{% endif %}
                    </option>
                  {% endfor %}
                </select>
              {% else %}
                <input
                  type="hidden"
                  name="id"
                  value="{{ current_variant.id }}">
              {% endif %}

              <div class="mt-4 flex flex-col items-stretch gap-4">
                <div class="flex items-center gap-6">
                  <div class="text-[#797979] text-sm leading-none">Quantity:</div>
                  <div class="relative">
                    <input
                      id="qty-{{ section.id }}"
                      name="quantity"
                      type="number"
                      inputmode="numeric"
                      min="1"
                      value="1"
                      class="qty-input w-[80px] h-[30px] rounded-md font-semibold border border-[#e7e7e7] bg-white pl-3 text-[12px] leading-none text-gray-900 text-left outline-none appearance-none">
                    <div class="absolute inset-y-0 right-2 w-[18px] flex flex-col rounded-r-[14px] overflow-hidden">
                      <button
                        type="button"
                        class="flex-1 grid place-content-center text-[#cfcfcf] hover:text-black transition-colors duration-300 ease-in-out cursor-pointer"
                        data-qty-plus="qty-{{ section.id }}"
                        aria-label="Increase quantity">
                        {% render 'icon-chevron-up' %}
                      </button>
                      <button
                        type="button"
                        class="flex-1 grid place-content-center text-[#cfcfcf] hover:text-black transition-colors duration-300 ease-in-out cursor-pointer"
                        data-qty-minus="qty-{{ section.id }}"
                        aria-label="Decrease quantity">
                        {% render 'icon-chevron-down' %}
                      </button>
                    </div>
                  </div>
                </div>

                <div class="flex flex-row gap-3 mt-5">

                  <button
                    type="submit"
                    class="inline-flex items-center justify-center h-10 px-7 bg-[#71CD14] hover:bg-transparent border border-[#71CD14] hover:text-[#71CD14] uppercase transition-all duration-400 cursor-pointer ease-in-out text-white text-xs font-medium rounded"
                    data-add-to-cart>
                    Add to cart
                  </button>
                  <div class="flex items-center gap-2">
                    <button
                      type="button"
                      class="w-10 h-10 grid place-content-center bg-[#F6F6F6] cursor-pointer hover:bg-transparent rounded tile-btn"
                      aria-label="Compare">
                      {% render 'icon-diamond' %}
                    </button>
                    <button
                      type="button"
                      class="w-10 h-10 grid place-content-center bg-[#F6F6F6] cursor-pointer hover:bg-transparent  rounded tile-btn"
                      aria-label="Wishlist"
                      data-wishlist
                      data-product-handle="{{ product.handle }}">
                      {% render 'icon-heart' %}
                    </button>
                  </div>
                </div>
              </div>
            {% endform %}
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="mt-14 border border-[#F6F6F6]">
      <div class="flex gap-3 overflow-hidden bg-[#F6F6F6] flex-row justify-center py-2.5">
        {% assign tabs = 'Description|Specification|Comments|Reviews' | split: '|' %}
        {% for title in tabs %}
          <button
            type="button"
            class="tab-btn px-8 py-3 text-xs border font-medium cursor-pointer bg-[#FFFFFF] border-gray-200 text-[#2A2A2A] hover:text-[#71CD14] data-[active=true]:bg-[#71CD14] data-[active=true]:text-white"
            data-tab-target="tab-{{ forloop.index }}-{{ section.id }}"
            aria-pressed="false">
            {{ title }}
          </button>
        {% endfor %}
      </div>

      <div class="mt-6 px-10 pt-2 pb-8">
        <!-- Description -->
        <div id="tab-1-{{ section.id }}" class="tab-pane hidden">
          <div class="text-sm text-[#797979] leading-7 max-full">
            {{ product.metafields.custom.description | default: '—' }}
          </div>
        </div>

        <!-- Specification -->
        <div id="tab-2-{{ section.id }}" class="tab-pane hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full text-left text-sm">
              <tbody class="divide-y divide-gray-200">
                <tr>
                  <td class="py-5 pl-10 font-medium text-[#797979]">Width</td>
                  <td class="py-2 text-[#797979]">{{ product.metafields.custom.width | default: '—' }}</td>
                </tr>
                <tr>
                  <td class="py-5 pl-10 font-medium text-[#797979]">Height</td>
                  <td class="py-2 text-[#797979]">{{ product.metafields.custom.height | default: '—' }}</td>
                </tr>
                <tr>
                  <td class="py-5 pl-10 font-medium text-[#797979]">Depth</td>
                  <td class="py-2 text-[#797979]">{{ product.metafields.custom.depth | default: '—' }}</td>
                </tr>
                <tr>
                  <td class="py-5 pl-10 font-medium text-[#797979]">Weight</td>
                  <td class="py-2 text-[#797979]">{{ product.metafields.custom.weight | default: '—' }}</td>
                </tr>
                <tr>
                  <td class="py-5 pl-10 font-medium text-[#797979]">Quality Checking</td>
                  <td class="py-2 text-[#797979]">
                    {{ product.metafields.custom.quality_checking | default: '—' }}
                  </td>
                </tr>
                <tr>
                  <td class="py-5 pl-10 font-medium text-[#797979]">Freshness Duration</td>
                  <td class="py-2 text-[#797979]">{{ product.metafields.custom.freshness_duration | default: '—' }}</td>
                </tr>
                <tr>
                  <td class="py-5 pl-10 font-medium text-[#797979]">Each Box Contains</td>
                  <td class="py-2 text-[#797979]">{{ product.metafields.custom.eaxh_box_contains | default: '—' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Comments -->
        <div id="tab-3-{{ section.id }}" class="tab-pane hidden">
          <div class="grid md:grid-cols-2 gap-10">
            <!-- Comments list -->
            <div class="space-y-8">
              {% assign comment_images = 'review-1.png|review-2.png|review-3.png' | split: '|' %}
              {% for i in (1..3) %}
                {% assign image_index = forloop.index0 %}
                {% assign review_image = comment_images[image_index] %}
                <div class="flex gap-5">
                  <div class="w-16 h-16 rounded-full overflow-hidden shrink-0">
                    <img
                      src="{{ 'single-product/' | append: review_image | asset_url }}"
                      alt="Reviewer"
                      class="w-full h-full object-cover"
                      loading="lazy"
                      width="64"
                      height="64">
                  </div>
                  <div class="flex-1">
                    <div class="flex items-center gap-3">
                      <h4 class="font-medium text-gray-900">Blake Ruiz</h4>
                      <p class="text-xs text-[#797979]">12th Feb, 2017 at 05:56 pm</p>
                    </div>
                    <p class="mt-2 text-sm leading-6 text-[#797979]">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo.</p>
                    <div class="mt-3">
                      <button type="button" class="px-5 h-9 inline-flex items-center justify-center border border-gray-300 text-[#2A2A2A] rounded-full hover:border-gray-400 uppercase text-xs">Reply</button>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>

            <!-- Comment form -->
            <div>
              <h4 class="text-gray-900 font-semibold mb-4">Post a comment</h4>
              <form class="grid grid-cols-1 gap-4">
                <input
                  type="text"
                  class="h-9 border border-gray-300 rounded px-4 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Your Full name">
                <input
                  type="email"
                  class="h-11 border border-gray-300 rounded px-4 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Email Address">
                <input
                  type="text"
                  class="h-11 border border-gray-300 rounded px-4 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Phone Number">
                <textarea
                  class="border border-gray-300 rounded px-4 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13] resize-y"
                  rows="1"
                  placeholder="Message"></textarea>
                <div class="text-end">
                  <button type="button" class="inline-flex h-11 cursor-pointer items-center bg-[#71cd13] hover:bg-transparent border border-[#71cd13] hover:text-[#71cd13] px-6 text-sm font-semibold uppercase tracking-wide text-white transition-colors duration-200 ease-in">Submit Now</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Reviews -->
        <div id="tab-4-{{ section.id }}" class="tab-pane hidden">
          <div class="grid md:grid-cols-2 gap-10">
            <!-- Left: overall + breakdown + recent reviews -->
            <div>
              <div class="grid grid-cols-2 gap-6">
                <!-- Overall card -->
                <div class="bg-[#F5F5F5] rounded p-6 text-center">
                  <h5 class="text-[#2A2A2A] text-2xl font-medium">Overall</h5>
                  <p class="mt-2 text-[44px] leading-none font-bold text-[#71CD14]">4.0</p>
                  <p class="mt-3 text-sm text-[#797979]">(03 Reviews)</p>
                </div>
                <!-- Breakdown -->
                <div>
                  <h3 class="text-gray-900 font-semibold mb-2 text-xl">Based on 3 Reviews</h3>
                  <ul class="-space-y-1 text-sm text-[#797979]">
                    {% assign breakdown = '5|4|3|2|1' | split: '|' %}
                    {% for stars in breakdown %}
                      <li class="flex items-center gap-2">
                        <span>{{ stars }} Star</span>
                        <span class="text-yellow-400 text-xl">★★★★★</span>
                        <span>01</span>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>

              <div class="mt-8 space-y-8">
                {% assign review_images = 'review-1.png|review-2.png|review-3.png' | split: '|' %}
                {% for i in (1..3) %}
                  {% assign image_index = forloop.index0 %}
                  {% assign review_image = review_images[image_index] %}
                  <div class="flex items-start gap-4">
                    <div class="w-16 h-16 rounded-full overflow-hidden shrink-0">
                      <img
                        src="{{ 'single-product/' | append: review_image | asset_url }}"
                        alt="Reviewer"
                        class="w-full h-full object-cover"
                        loading="lazy"
                        width="64"
                        height="64">
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center gap-3">
                        <h4 class="font-medium text-gray-900">Blake Ruiz</h4>
                        <div class="text-yellow-400 text-xl">★★★★★</div>
                      </div>
                      <p class="mt-2 text-sm leading-6 text-[#797979]">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo.</p>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>

            <!-- Right: add a review form -->
            <div>
              <h4 class="text-gray-900 font-semibold mb-4 text-2xl">Add a Review</h4>
              <div class="mb-4 flex items-center gap-3 text-sm text-[#797979]">
                <span>Your Rating:</span>
                <div class="flex items-center gap-1">
                  <span class="text-yellow-400 text-xl">★★★★★</span>
                </div>
                <span>Outstanding</span>
              </div>
              <form class="grid grid-cols-1 gap-3">
                <input
                  type="text"
                  class="h-10 border border-gray-300 rounded px-3 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Your Full name">
                <input
                  type="email"
                  class="h-10 border border-gray-300 rounded px-3 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Email Address">
                <input
                  type="text"
                  class="h-10 border border-gray-300 rounded px-3 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13]"
                  placeholder="Phone Number">
                <textarea
                  class="border border-gray-300 rounded px-3 text-base py-2 font-medium text-[#2A2A2A] placeholder:text-[#7C7C7C] focus:outline-none focus:border-[#71cd13] resize-y"
                  rows="1"
                  placeholder="Review"></textarea>
                <div class="text-end mt-1">
                  <button type="button" class="inline-flex h-11 cursor-pointer items-center bg-[#71cd13] hover:bg-transparent border border-[#71cd13] hover:text-[#71cd13] px-6 text-sm font-semibold uppercase tracking-wide text-white transition-colors duration-200 ease-in">Submit Now</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* Hide native number input controls; we use our own chevrons */
    #qty-{{ section.id }}::-webkit-outer-spin-button,
    #qty-{{ section.id }}::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    #qty-{{ section.id }} {
      -moz-appearance: textfield;
    }
    /* Hover shadow for small icon tiles (lower-left) */
    .tile-btn {
      transition: box-shadow 220ms ease
      , transform 220ms ease
      , background-color 220ms ease;
      box-shadow: none;
    }
    .tile-btn:hover {
      box-shadow: -20px 20px 30px rgba(0, 0, 0, 0.16);
    }
  </style>

  <script>
    (function() {
      // AJAX add to cart
      var productForm = document.querySelector('[data-product-form]');
      if (productForm) {
        var addButton = productForm.querySelector('[data-add-to-cart]');
        var statusEl = productForm.querySelector('[data-add-status]');
        var qtyInput = productForm.querySelector('input[name="quantity"]');
        var variantSelector = productForm.querySelector('select[name="id"], input[name="id"]');

        function showStatus(message, tone) {
          if (!statusEl) return;
          statusEl.textContent = message;
          statusEl.classList.remove('hidden');
          if (tone === 'error') {
            statusEl.classList.add('text-rose-600');
            statusEl.classList.remove('text-[#71cd13]');
          } else {
            statusEl.classList.add('text-[#71cd13]');
            statusEl.classList.remove('text-rose-600');
          }
          if (statusEl._timer) clearTimeout(statusEl._timer);
          statusEl._timer = setTimeout(function(){ statusEl.classList.add('hidden'); }, tone === 'error' ? 4000 : 2200);
        }

        productForm.addEventListener('submit', function(event) {
          event.preventDefault();
          if (addButton) addButton.disabled = true;

          var variantId = variantSelector ? variantSelector.value : '';
          var quantity = qtyInput ? parseInt(qtyInput.value || '1', 10) : 1;
          if (!variantId) {
            showStatus('Select an option', 'error');
            if (addButton) addButton.disabled = false;
            return;
          }

          quantity = Math.max(1, Number.isFinite(quantity) ? quantity : 1);

          var payload = { id: variantId, quantity: quantity };
          var request;

          if (window.ShopCart && typeof window.ShopCart.add === 'function') {
            request = window.ShopCart.add(payload);
          } else {
            request = fetch('/cart/add.js', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            })
              .then(function(response) {
                if (!response.ok) throw new Error('Request failed');
                return response.json();
              })
              .then(function(){ try { window.dispatchEvent(new CustomEvent('cart:updated')); } catch(err) {} });
          }

          Promise.resolve(request)
            .then(function(){
              showStatus('Added to cart', 'success');
            })
            .catch(function(){
              showStatus('Could not add to cart', 'error');
            })
            .finally(function(){
              if (addButton) addButton.disabled = false;
            });
        });
      }

      // Carousel: loop through main images; sync red shade on thumbnails
      var carousel = document.getElementById('carousel-{{ section.id }}');
      if (carousel) {
        var track = carousel.querySelector('[data-track]');
        var slides = track ? track.children : [];
        var thumbs = carousel.querySelectorAll('[data-slide-to]');
        var hover = false;
        function normalize(i){
          if (!slides.length) return 0;
          return (i % slides.length + slides.length) % slides.length;
        }
        function setThumbActive(index){
          // thumbs exclude the first (main) image; map slide index to thumb index (index-1)
          thumbs.forEach(function(t){ t.dataset.active = 'false'; });
          if (index > 0 && thumbs[index - 1]) {
            thumbs[index - 1].dataset.active = 'true';
          }
        }
        var idx = 0;
        function go(i){
          if (!track || !slides.length) return;
          idx = normalize(i);
          track.style.transform = 'translateX(' + (-idx * 100) + '%)';
          setThumbActive(idx);
        }
        // autoplay (shorter duration)
        var timer = null;
        function startTimer(){
          if (timer) clearInterval(timer);
          timer = setInterval(function(){ if (!hover) go(idx + 1); }, 2000);
        }
        carousel.addEventListener('mouseenter', function(){ hover = true; });
        carousel.addEventListener('mouseleave', function(){ hover = false; });
        // clicking thumbs replaces main image and keeps loop running
        thumbs.forEach(function(t){
          t.addEventListener('click', function(e){
            e.preventDefault();
            var k = parseInt(t.getAttribute('data-slide-to'), 10) || 0;
            go(k);
            startTimer();
          });
        });
        go(0);
        startTimer();
      }
    
      // Quantity controls
      var minus = document.querySelector('[data-qty-minus="qty-{{ section.id }}"]');
      var plus = document.querySelector('[data-qty-plus="qty-{{ section.id }}"]');
      var input = document.getElementById('qty-{{ section.id }}');
      if (minus && plus && input) {
        minus.addEventListener('click', function(){
          var v = parseInt(input.value || '1', 10);
          input.value = Math.max(1, v - 1);
        });
        plus.addEventListener('click', function(){
          var v = parseInt(input.value || '1', 10);
          input.value = v + 1;
        });
      }
    
      // Tabs
      var tabButtons = document.querySelectorAll('.tab-btn[data-tab-target$="{{ section.id }}"]');
      var panes = document.querySelectorAll('.tab-pane[id$="{{ section.id }}"]');
      function activate(targetId) {
        panes.forEach(function(p){ p.classList.add('hidden'); });
        tabButtons.forEach(function(b){ b.dataset.active = 'false'; b.setAttribute('aria-pressed', 'false'); });
        var p = document.getElementById(targetId);
        var b = Array.prototype.find.call(tabButtons, function(x){ return x.dataset.tabTarget === targetId; });
        if (p) p.classList.remove('hidden');
        if (b) { b.dataset.active = 'true'; b.setAttribute('aria-pressed', 'true'); }
      }
      if (tabButtons.length) {
        tabButtons.forEach(function(btn){
          btn.addEventListener('click', function(){ activate(btn.dataset.tabTarget); });
        });
        if (document.getElementById('tab-4-{{ section.id }}')) {
          activate('tab-4-{{ section.id }}');
        }
      }
    })();
  </script>
</section>

{% schema %}
  {
    "name": "Product",
    "tag": "section",
    "class": "section-product-detail",
    "settings": [],
    "disabled_on": {
      "groups": ["header", "footer"]
    }
  }
{% endschema %}