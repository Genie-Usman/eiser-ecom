<section id="comments" class="mt-8">
  {% if article.comments_count > 0 %}
    {% assign cc = article.comments_count | default: 0 %}
    {% if cc < 10 %}
      {% assign cc_str = cc | prepend: '0' %}
    {% else %}
      {% assign cc_str = cc %}
    {% endif %}
    <h3 class="mb-10 text-lg font-semibold text-[#2A2A2A]">{{ cc_str }} Comments</h3>
    <div class="space-y-10">

      {% assign comment_images = 'c1.png|c2.png|c3.png' | split: '|' %}
      {% assign comment_index = 0 %}
      {% for c in article.comments %}
        {% assign avatar_image = comment_images[comment_index] %}
        {% if avatar_image == blank %}
          {% assign avatar_image = 'c1.png' %}
        {% endif %}
        <div class="flex gap-5">
          <div class="h-16 w-16 shrink-0 overflow-hidden rounded-full">
            <img
              src="{{ avatar_image | asset_url }}"
              alt="{{ c.author | escape }}"
              class="h-full w-full object-cover"
              loading="lazy"
              width="64"
              height="64">
          </div>

          <div class="flex-1 ">
            <p class="text-sm leading-6 text-[#777777]">{{ c.content }}</p>
            <div class="flex items-center justify-between">
              <div class="mt-3">
                <div>
                  <span class="text-sm font-semibold text-[#2A2A2A]">{{ c.author }}</span>
                  <span class="text-xs text-[#CCCCCC] ml-2">{{ c.created_at | date: "%B %d, %Y at %I:%M %p" }}</span>
                </div>
              </div>
              <button
                type="button"
                class="reply-link mt-3 px-4 text-sm uppercase tracking-wider text-[#777777] transition-colors duration-200 hover:text-[#71cd13]"
                data-author="{{ c.author | escape }}">REPLY</button>
            </div>
          </div>
        </div>
        {% assign comment_index = comment_index | plus: 1 %}
        {% if comment_index >= 3 %}
          {% assign comment_index = 0 %}
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  {% if article.comments_enabled? %}
    <div class="mt-12">
      <h3 class="mb-6 text-lg font-semibold text-[#2A2A2A]">Leave a Reply</h3>
      {% form 'new_comment'
        , article %}
        {% if form.posted_successfully? %}
          <p class="mb-6 rounded border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-700">Thanks! Your comment was submitted. It will appear once approved.</p>
        {% endif %}

        {% if form.errors %}
          <div class="mb-6 rounded border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
            {{ form.errors | default_errors }}
          </div>
        {% endif %}

        <div id="comment-form" class="space-y-4">
          <textarea
            id="comment-body"
            name="comment[body]"
            class="w-full h-40 border border-gray-300 bg-white px-4 py-3 text-sm text-[#2A2A2A] placeholder:text-[#A3A3A3] focus:border-[#71cd13] focus:outline-none focus:ring-2 focus:ring-[#71cd13]/20 resize-y"
            placeholder="Write Comment"
            required>{{ form.body }}</textarea>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input
              class="h-12 w-full border border-gray-300 bg-white px-4 text-sm text-[#2A2A2A] placeholder:text-[#A3A3A3] focus:border-[#71cd13] focus:outline-none focus:ring-2 focus:ring-[#71cd13]/20"
              name="comment[author]"
              placeholder="Name"
              value="{{ form.author }}"
              required>
            <input
              class="h-12 w-full border border-gray-300 bg-white px-4 text-sm text-[#2A2A2A] placeholder:text-[#A3A3A3] focus:border-[#71cd13] focus:outline-none focus:ring-2 focus:ring-[#71cd13]/20"
              name="comment[email]"
              type="email"
              placeholder="Email"
              value="{{ form.email }}"
              required>
          </div>

          <input
            class="h-12 w-full border border-gray-300 bg-white px-4 text-sm text-[#2A2A2A] placeholder:text-[#A3A3A3] focus:border-[#71cd13] focus:outline-none focus:ring-2 focus:ring-[#71cd13]/20"
            name="comment[website]"
            placeholder="Website"
            value="{{ form.website }}">

          <button type="submit" class="h-12 w-40 bg-[#71cd13] border border-[#71cd13] hover:bg-transparent hover:text-[#71cd13] text-white text-sm font-semibold uppercase tracking-wide rounded transition-colors duration-200 cursor-pointer ease-in-out ">
            SEND MESSAGE
          </button>
        </div>
      {% endform %}
    </div>
  {% endif %}
  <script>
    document.addEventListener('click',function(e){
      var btn=e.target.closest('.reply-link');
      if(!btn) return;
      var name=btn.getAttribute('data-author')||'';
      var field=document.getElementById('comment-body');
      if(field){
        var mention='@'+name+' ';
        if(!field.value||field.value.indexOf(mention)!==0){field.value=mention+field.value;}
        document.getElementById('comment-form').scrollIntoView({behavior:'smooth',block:'center'});
        field.focus();
      }
    });
  </script>
</section>